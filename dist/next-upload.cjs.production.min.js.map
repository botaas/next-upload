{"version":3,"file":"next-upload.cjs.production.min.js","sources":["../src/utils/client.ts","../src/utils/keys.ts","../src/app/api/upload/s3/route.ts","../src/components/FileInput.tsx","../src/hooks/use-uploader.ts","../src/hooks/use-upload-files.tsx","../src/hooks/use-s3-upload.tsx","../src/hooks/use-presigned-upload.ts","../src/utils/private-files.ts","../src/utils/image-data.ts"],"sourcesContent":["import { S3Client } from '@aws-sdk/client-s3';\nimport { S3Config } from './config';\n\nexport function getClient(config: S3Config) {\n  const client = new S3Client({\n    credentials: {\n      accessKeyId: config.accessKeyId,\n      secretAccessKey: config.secretAccessKey,\n    },\n    region: config.region,\n    ...(config.forcePathStyle ? { forcePathStyle: config.forcePathStyle } : {}),\n    ...(config.endpoint ? { endpoint: config.endpoint } : {}),\n  });\n\n  return client;\n}","import { v4 as uuidv4 } from 'uuid';\n\nexport const uuid = () => uuidv4();\n\nconst SAFE_CHARACTERS = /[^0-9a-zA-Z!_\\\\.\\\\*'\\\\(\\\\)\\\\\\-/]/g;\nexport const sanitizeKey = (value: string) =>\n  value.replace(SAFE_CHARACTERS, ' ').replace(/\\s+/g, '-');","import { NextRequest, NextResponse } from \"next/server\";\nimport { PutObjectCommand } from '@aws-sdk/client-s3';\nimport { S3Config } from '../../../../utils/config';\nimport { getClient } from '../../../../utils/client';\nimport { sanitizeKey, uuid } from '../../../../utils/keys';\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\nimport {\n  STSClient,\n  GetFederationTokenCommand,\n  STSClientConfig,\n} from '@aws-sdk/client-sts';\n\n\ntype Options = S3Config & {\n  key?: (request: Request, filename: string) => string | Promise<string>;\n};\n\ntype OptionsFetcher = (request: NextRequest) => Promise<Options>;\n\nconst makeRouteHandler = (optionsFetcher?: OptionsFetcher) => {\n  const route = async function (request: NextRequest) {    \n    const { strategy, filename, filetype } = await request.json();\n    if (!optionsFetcher) {\n      return new Response(\"S3 Upload: Missing config\", { status: 400 })\n    }\n\n    const options = await optionsFetcher(request);\n    if (!options) {\n      return new Response(\"S3 Upload: No config fetched\", { status: 400 })\n    }\n\n    const key = options.key ? await Promise.resolve(options.key(request, filename)) : `uploads/${uuid()}/${sanitizeKey(filename)}`;\n    let { bucket, region, endpoint } = options;\n\n    if (strategy === 'presigned') {\n      const client = getClient(options);\n  \n      const params = {\n        Bucket: bucket,\n        Key: key,\n        ContentType: filetype,\n        CacheControl: 'max-age=630720000',\n      }\n\n      const url = await getSignedUrl(client, new PutObjectCommand(params), {\n        expiresIn: 60 * 60,\n      });\n\n      return NextResponse.json({\n        key,\n        bucket,\n        region,\n        endpoint,\n        url,\n      });\n    } else {\n      let stsConfig: STSClientConfig = {\n        credentials: {\n          accessKeyId: options.accessKeyId,\n          secretAccessKey: options.secretAccessKey,\n        },\n        region,\n      };\n\n      const policy = {\n        Statement: [\n          {\n            Sid: 'Stmt1S3UploadAssets',\n            Effect: 'Allow',\n            Action: ['s3:PutObject'],\n            Resource: [`arn:aws:s3:::${bucket}/${key}`],\n          },\n        ],\n      };\n\n      const sts = new STSClient(stsConfig);\n\n      const command = new GetFederationTokenCommand({\n        Name: 'S3UploadWebToken',\n        Policy: JSON.stringify(policy),\n        DurationSeconds: 60 * 60, // 1 hour\n      });\n\n      const token = await sts.send(command);\n\n      return NextResponse.json({\n        token,\n        key,\n        bucket,\n        region,\n      });\n    }\n  }\n\n  let configure = (optionsFetcher: OptionsFetcher) => makeRouteHandler(optionsFetcher);\n  return Object.assign(route, { configure })\n}\n\nconst APIRoute = makeRouteHandler();\nexport { APIRoute }\n","import React, { ChangeEvent, InputHTMLAttributes } from 'react';\nimport { forwardRef } from 'react';\n\ntype FileInputProps = {\n  onChange: (\n    file: File | undefined,\n    event: ChangeEvent<HTMLInputElement>\n  ) => void;\n} & InputHTMLAttributes<HTMLInputElement>;\n\nexport const FileInput = forwardRef<HTMLInputElement, FileInputProps>(\n  ({ onChange = () => {}, ...restOfProps }, forwardedRef) => {\n    let handleChange = (event: ChangeEvent<HTMLInputElement>): void => {\n      let file = event.target?.files?.[0];\n      onChange(file, event);\n    };\n\n    return (\n      <input\n        onChange={handleChange}\n        {...restOfProps}\n        ref={forwardedRef}\n        type=\"file\"\n      />\n    );\n  }\n);","import { useUploadFiles } from './use-upload-files';\n\ntype UploadResult = {\n  url: string;\n  bucket: string;\n  key: string;\n};\n\ntype RequestOptions = {\n  url?: string;\n  body?: Record<string, any>;\n  headers?: HeadersInit;\n};\n\ntype UploadToS3Options = {\n  endpoint?: {\n    request: RequestOptions;\n  };\n};\n\n// Outdated options we no longer want support.\ntype OldOptions = {\n  endpoint: string;\n};\n\ntype Strategy = 'presigned' | 'aws-sdk';\n\nexport type Uploader<P = any> = (\n  file: File,\n  params: P,\n  eventHandlers: {\n    onProgress: (uploaded: number) => void;\n  }\n) => Promise<UploadResult>;\n\nexport const useUploader = (\n  strategy: Strategy,\n  uploader: Uploader,\n  oldOptions?: OldOptions\n) => {\n  let {\n    addFile,\n    updateFileProgress,\n    FileInput,\n    openFileDialog,\n    files,\n    resetFiles,\n  } = useUploadFiles();\n\n  let uploadToS3 = async (file: File, options: UploadToS3Options = {}) => {\n    // combine old options and new options. remove after 1.0\n    if (oldOptions?.endpoint) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(\n          '[Next S3 Upload] The `endpoint` option has been replaced by `endpoint.request.url`. For more information see: https://next-s3-upload.codingvalue.com/changes/endpoint'\n        );\n      }\n\n      if (options.endpoint) {\n        options.endpoint.request.url = oldOptions.endpoint;\n      } else {\n        options.endpoint = {\n          request: {\n            url: oldOptions.endpoint,\n          },\n        };\n      }\n    }\n\n    const params = await getUploadParams(\n      strategy,\n      file,\n      options.endpoint?.request\n    );\n\n    if (params.error) {\n      console.error(params.error);\n      throw params.error;\n    }\n\n    addFile(file);\n\n    const result = await uploader(file, params, {\n      onProgress: uploaded => updateFileProgress(file, uploaded),\n    });\n\n    return result;\n  };\n\n  return {\n    FileInput,\n    openFileDialog,\n    uploadToS3,\n    files,\n    resetFiles,\n  };\n};\n\nlet getUploadParams = async (\n  strategy: Strategy,\n  file: File,\n  requestOptions?: RequestOptions\n) => {\n  let additionalBody = requestOptions?.body ?? {};\n  let additionalHeaders = requestOptions?.headers ?? {};\n  let apiRouteUrl = requestOptions?.url ?? '/api/upload/s3';\n\n  let body = {\n    filename: file.name,\n    filetype: file.type,\n    strategy,\n    ...additionalBody,\n  };\n\n  let headers = {\n    ...additionalHeaders,\n    'Content-Type': 'application/json',\n  };\n\n  let res = await fetch(apiRouteUrl, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(body),\n  });\n\n  return await res.json();\n};","import React from 'react';\nimport { FileInput } from '../components/FileInput';\nimport { useRef, useState } from 'react';\n\ntype TrackedFile = {\n  file: File;\n  progress: number;\n  uploaded: number;\n  size: number;\n};\n\nexport const useUploadFiles = () => {\n  let ref = useRef<HTMLInputElement>();\n  let [files, setFiles] = useState<TrackedFile[]>([]);\n\n  let openFileDialog = () => {\n    if (ref.current) {\n      ref.current.value = '';\n      ref.current?.click();\n    }\n  };\n\n  let resetFiles = () => {\n    setFiles([]);\n  };\n\n  let updateFileProgress = (file: File, uploaded: number) => {\n    setFiles(files =>\n      files.map(trackedFile =>\n        trackedFile.file === file\n          ? {\n              file,\n              uploaded,\n              size: file.size,\n              progress: file.size ? (uploaded / file.size) * 100 : 0,\n            }\n          : trackedFile\n      )\n    );\n  };\n\n  let addFile = (file: File) => {\n    setFiles(files => [\n      ...files,\n      { file, progress: 0, uploaded: 0, size: file.size },\n    ]);\n  };\n\n  return {\n    FileInput: (props: any) => (\n      <FileInput {...props} ref={ref} style={{ display: 'none' }} />\n    ),\n    openFileDialog,\n    files,\n    addFile,\n    updateFileProgress,\n    resetFiles,\n  };\n};","import {\n  CompleteMultipartUploadCommandOutput,\n  S3Client,\n} from '@aws-sdk/client-s3';\nimport { Upload } from '@aws-sdk/lib-storage';\nimport { Uploader, useUploader } from './use-uploader';\n\ntype Params = {\n  key: string;\n  bucket: string;\n  token: Record<string, any>;\n  region: string;\n};\n\nlet upload: Uploader<Params> = async (file, params, { onProgress }) => {\n  let { key, bucket, token, region } = params;\n\n  let client = new S3Client({\n    credentials: {\n      accessKeyId: token.Credentials.AccessKeyId,\n      secretAccessKey: token.Credentials.SecretAccessKey,\n      sessionToken: token.Credentials.SessionToken,\n    },\n    region: region,\n  });\n\n  let uploadParams = {\n    Bucket: bucket,\n    Key: key,\n    Body: file,\n    CacheControl: 'max-age=630720000, public',\n    ContentType: file.type,\n  };\n\n  // at some point make this configurable\n  // let uploadOptions = {\n  //   partSize: 100 * 1024 * 1024,\n  //   queueSize: 1,\n  // };\n\n  let s3Upload = new Upload({\n    client,\n    params: uploadParams,\n  });\n\n  s3Upload.on('httpUploadProgress', progress => {\n    let uploaded = progress.loaded ?? 0;\n    onProgress(uploaded);\n  });\n\n  let uploadResult = (await s3Upload.done()) as CompleteMultipartUploadCommandOutput;\n\n  let url =\n    uploadResult.Bucket && uploadResult.Key\n      ? `https://${uploadResult.Bucket}.s3.${region}.amazonaws.com/${uploadResult.Key}`\n      : '';\n\n  return {\n    url,\n    bucket: uploadResult.Bucket ?? '',\n    key: uploadResult.Key ?? '',\n  };\n};\n\nexport const useS3Upload = (options?: { endpoint: string }) => {\n  let hook = useUploader('aws-sdk', upload, options);\n  return hook;\n};","import { Uploader, useUploader } from './use-uploader';\n\nlet upload: Uploader = async (file, params, { onProgress }) => {\n  let { url, key, bucket, region, endpoint } = params;\n  let buffer = await file.arrayBuffer();\n\n  await new Promise<void>((resolve, reject) => {\n    let xhr = new XMLHttpRequest();\n\n    xhr.upload.onprogress = (event: ProgressEvent) => {\n      onProgress(event.loaded);\n    };\n\n    xhr.open('PUT', url, true);\n    xhr.setRequestHeader('Content-Type', file.type);\n    xhr.setRequestHeader('Cache-Control', 'max-age=630720000');\n\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        if (xhr.status >= 200 && xhr.status < 300) {\n          resolve();\n        } else {\n          reject();\n        }\n      }\n    };\n\n    xhr.send(buffer);\n  });\n\n  let resultUrl = endpoint\n    ? `${endpoint}/${bucket}/${key}`\n    : `https://${bucket}.s3.${region}.amazonaws.com/${key}`;\n\n  return {\n    url: resultUrl,\n    bucket,\n    key,\n  };\n};\n\nexport const usePresignedUpload = () => {\n  let hook = useUploader('presigned', upload);\n  return hook;\n};","import { getSignedUrl } from '@aws-sdk/s3-request-presigner';\nimport { GetObjectCommand } from '@aws-sdk/client-s3';\nimport { S3Config } from './config';\nimport { getClient } from './client';\n\nexport const generateTemporaryUrl = async (\n  key: string,\n  config: S3Config\n) => {\n  let client = getClient(config);\n\n  let command = new GetObjectCommand({\n    Bucket: config.bucket,\n    Key: key,\n  });\n\n  let url = await getSignedUrl(client, command, { expiresIn: 3600 });\n\n  return url;\n};","interface ImageData {\n  height: number | undefined;\n  width: number | undefined;\n}\n\nexport const getImageData = (file: File | Blob): Promise<ImageData> => {\n  return new Promise(resolve => {\n    if (file.type.split('/')?.[0] === 'image') {\n      let img = new Image();\n      let objectUrl = URL.createObjectURL(file);\n      img.onload = (event: Event) => {\n        let image = event.target as HTMLImageElement;\n        resolve({ height: image.height, width: image.width });\n        URL.revokeObjectURL(objectUrl);\n      };\n      img.src = objectUrl;\n    } else {\n      resolve({ height: undefined, width: undefined });\n    }\n  });\n};"],"names":["getClient","config","S3Client","_extends","credentials","accessKeyId","secretAccessKey","region","forcePathStyle","endpoint","uuid","uuidv4","SAFE_CHARACTERS","sanitizeKey","value","replace","APIRoute","makeRouteHandler","optionsFetcher","Object","assign","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","request","_yield$request$json","strategy","filename","filetype","options","key","bucket","client","params","policy","sts","command","wrap","_context","prev","next","json","sent","abrupt","Response","status","Promise","resolve","t0","Bucket","Key","ContentType","CacheControl","getSignedUrl","PutObjectCommand","expiresIn","NextResponse","url","Statement","Sid","Effect","Action","Resource","STSClient","GetFederationTokenCommand","Name","Policy","JSON","stringify","DurationSeconds","send","token","stop","_x","apply","arguments","configure","FileInput","forwardRef","forwardedRef","onChange","_ref$onChange","restOfProps","_objectWithoutPropertiesLoose","_excluded","React","event","file","_event$target","target","_event$target$files","files","ref","type","useUploader","uploader","oldOptions","_useState","setFiles","_useUploadFiles","useRef","useState","props","style","display","openFileDialog","_ref$current","current","click","addFile","concat","progress","uploaded","size","updateFileProgress","map","trackedFile","resetFiles","uploadToS3","getUploadParams","_options$endpoint","error","console","onProgress","_x2","_ref2","_callee2","requestOptions","_requestOptions$body","_requestOptions$heade","_requestOptions$url","additionalBody","additionalHeaders","apiRouteUrl","body","headers","res","_context2","name","Content-Type","fetch","method","_x3","_x4","_x5","upload","_uploadResult$Bucket","_uploadResult$Key","s3Upload","uploadResult","Credentials","AccessKeyId","SecretAccessKey","sessionToken","SessionToken","Upload","Body","on","_progress$loaded","loaded","done","buffer","arrayBuffer","reject","xhr","XMLHttpRequest","onprogress","open","setRequestHeader","onreadystatechange","readyState","generateTemporaryUrl","GetObjectCommand","_file$type$split","split","img","Image","objectUrl","URL","createObjectURL","onload","image","height","width","revokeObjectURL","src","undefined"],"mappings":"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"}